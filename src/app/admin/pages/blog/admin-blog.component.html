<div class="blog-page">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1>Blog Management</h1>
      <p>Create and manage blog posts</p>
    </div>
    <button class="btn-primary" (click)="openModal('create')">
      <i class="fas fa-plus"></i>
      New Post
    </button>
  </div>

  <!-- Stats -->
  <div class="stats-row">
    <div class="stat-card">
      <div class="stat-icon published"><i class="fas fa-check-circle"></i></div>
      <div class="stat-info">
        <div class="stat-number">{{publishedCount}}</div>
        <div class="stat-label">Published Posts</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon draft"><i class="fas fa-edit"></i></div>
      <div class="stat-info">
        <div class="stat-number">{{draftCount}}</div>
        <div class="stat-label">Draft Posts</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon views"><i class="fas fa-eye"></i></div>
      <div class="stat-info">
        <div class="stat-number">{{totalViews}}</div>
        <div class="stat-label">Total Views</div>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <div class="search-box">
      <i class="fas fa-search"></i>
      <input type="text" placeholder="Search posts..." [(ngModel)]="searchTerm">
    </div>
    <select class="filter-select" [(ngModel)]="statusFilter">
      <option value="">All Status</option>
      <option value="published">Published</option>
      <option value="draft">Draft</option>
    </select>
  </div>

  <!-- Posts Grid -->
  <div class="posts-grid">
    <div class="post-card" *ngFor="let post of blogPosts">
      <div class="post-image">
        <img *ngIf="getImageUrl(post)" [src]="getImageUrl(post)" [alt]="post.title">
        <div *ngIf="!getImageUrl(post)" class="no-image">No Image</div>
        <div class="post-status" [class]="'status-' + post.status">{{post.status}}</div>
        <div class="post-category">{{getCategoryName(post)}}</div>
      </div>
      <div class="post-content">
        <h3>{{post.title}}</h3>
        <p>{{post.excerpt}}</p>
        <div class="post-meta">
          <div class="meta-item">
            <i class="fas fa-calendar"></i>
            <span>{{(post.created_at | date:'short')}}</span>
          </div>
          <div class="meta-item">
            <i class="fas fa-eye"></i>
            <span>{{post.views_count || 0}} views</span>
          </div>
          <div class="meta-item">
            <i class="fas fa-user"></i>
            <span>{{getAuthorName(post)}}</span>
          </div>
        </div>
        <div class="post-actions">
          <button class="action-btn view" (click)="viewPost(post)" title="View">
            <span class="material-icons">visibility</span>
          </button>
          <button class="action-btn edit" (click)="openModal('edit', post)" title="Edit">
            <span class="material-icons">edit</span>
          </button>
          <!-- <button class="action-btn publish" *ngIf="post.status === 'draft'" (click)="publishPost(post.id)" title="Publish">
            <span class="material-icons">publish</span>
          </button> -->
          <button class="action-btn delete" (click)="deletePost(post.id)" title="Delete">
            <span class="material-icons">delete</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
    <div class="modal-content large" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>{{modalMode === 'create' ? 'Create New Post' : 'Edit Post'}}</h3>
        <button class="close-btn" (click)="closeModal()"><span class="material-icons">close</span></button>
      </div>
      <div class="modal-body">
        <div class="form-grid">
          <div class="form-group full-width">
            <label>Post Title *</label>
            <input type="text" [(ngModel)]="selectedPost.title" placeholder="Enter post title" required>
          </div>
          <div class="form-group">
            <label>Category *</label>
            <select [(ngModel)]="selectedPost.category" required>
              <option [value]="null" disabled>Select a category</option>
              <option *ngFor="let cat of categories" [value]="cat.id">{{cat.name}}</option>
            </select>
          </div>
          <div class="form-group">
            <label>Status</label>
            <select [(ngModel)]="selectedPost.status">
              <option value="draft">Draft</option>
              <option value="published">Published</option>
            </select>
          </div>
          <div class="form-group full-width">
            <label>Featured Image</label>
            <input type="file" (change)="onFileSelected($event)" accept="image/*">
            <small class="text-muted">Max file size: 3MB. Supported formats: JPG, PNG, GIF</small>
            <small *ngIf="selectedFile" class="text-success">Selected: {{selectedFile.name}}</small>
            <small *ngIf="selectedPost.featured_image" class="text-muted">Current: {{selectedPost.featured_image}}</small>
          </div>
          <div class="form-group full-width">
            <label>Excerpt *</label>
            <textarea [(ngModel)]="selectedPost.excerpt" rows="3" placeholder="Brief description (max 300 characters)..." maxlength="300" required></textarea>
            <small class="text-muted">{{selectedPost.excerpt?.length || 0}}/300 characters</small>
          </div>
          <div class="form-group full-width">
            <label>Content *</label>
            <textarea [(ngModel)]="selectedPost.content" rows="8" placeholder="Write your post content..." required></textarea>
          </div>
          <div class="form-group">
            <label>Read Time (minutes)</label>
            <input type="number" [(ngModel)]="selectedPost.read_time" min="1" placeholder="5">
          </div>
          <div class="form-group">
            <label>
              <input type="checkbox" [(ngModel)]="selectedPost.is_featured">
              Featured Post
            </label>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" (click)="closeModal()">Cancel</button>
        <button class="btn-primary" (click)="savePost()" [disabled]="saving">
          <span *ngIf="saving" class="material-icons animate-spin">refresh</span>
          {{saving ? 'Saving...' : (modalMode === 'create' ? 'Create Post' : 'Update Post')}}
        </button>
      </div>
    </div>
  </div>

  <!-- View Modal -->
  <div class="modal-overlay" *ngIf="showViewModal" (click)="closeModal()">
    <div class="modal-content large" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>{{selectedPost.title}}</h3>
        <button class="close-btn" (click)="closeModal()"><span class="material-icons">close</span></button>
      </div>
      <div class="modal-body view-modal">
        <div class="view-image" *ngIf="getImageUrl(selectedPost)">
          <img [src]="getImageUrl(selectedPost)" [alt]="selectedPost.title">
        </div>
        <div class="view-meta">
          <span class="view-category">{{getCategoryName(selectedPost)}}</span>
          <span class="view-status" [class]="'status-' + selectedPost.status">{{selectedPost.status}}</span>
          <span class="view-featured" *ngIf="selectedPost.is_featured">Featured</span>
        </div>
        <div class="view-details">
          <p><strong>Author:</strong> {{getAuthorName(selectedPost)}}</p>
          <p><strong>Read Time:</strong> {{selectedPost.read_time || 5}} minutes</p>
          <p><strong>Views:</strong> {{selectedPost.views_count || 0}}</p>
          <p><strong>Created:</strong> {{selectedPost.created_at | date:'medium'}}</p>
        </div>
        <div class="view-excerpt">
          <h4>Excerpt</h4>
          <p>{{selectedPost.excerpt}}</p>
        </div>
        <div class="view-content">
          <h4>Content</h4>
          <div [innerHTML]="selectedPost.content"></div>
        </div>
      </div>
    </div>
  </div>
</div>