<div class="users-page">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner">
      <i class="fas fa-spinner fa-spin"></i>
      <p>Loading users...</p>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !isLoading" class="error-container">
    <div class="error-message">
      <i class="fas fa-exclamation-triangle"></i>
      <h3>{{ error }}</h3>
      <button class="btn-retry" (click)="loadUsers(currentPage)">
        <i class="fas fa-redo"></i>
        Retry
      </button>
    </div>
  </div>

  <!-- Main Content -->
  <div *ngIf="!isLoading && !error">
    <div class="page-header">
      <div class="header-content">
        <h1>User Management</h1>
        <p>Manage and monitor all registered users</p>
      </div>
      <button class="btn-primary" (click)="openModal('create')">
        <i class="fas fa-plus"></i>
        Add New User
      </button>
    </div>

    <!-- Stats Cards -->
    <div class="stats-row">
      <div class="stat-card">
        <div class="stat-icon active"><i class="fas fa-users"></i></div>
        <div class="stat-info">
          <div class="stat-number">{{activeUsersCount}}</div>
          <div class="stat-label">Active Users</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon inactive"><i class="fas fa-user-slash"></i></div>
        <div class="stat-info">
          <div class="stat-number">{{inactiveUsersCount}}</div>
          <div class="stat-label">Inactive Users</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon total"><i class="fas fa-chart-line"></i></div>
        <div class="stat-info">
          <div class="stat-number">{{totalUsersCount}}</div>
          <div class="stat-label">Total Users</div>
        </div>
      </div>
    </div>

    <!-- Filters -->
    <div class="filters-section">
      <div class="search-box">
        <i class="fas fa-search"></i>
        <input type="text" placeholder="Search users..." [(ngModel)]="searchTerm" (input)="onSearchChange()">
      </div>
      <select class="filter-select" [(ngModel)]="statusFilter">
        <option value="">All Status</option>
        <option value="active">Active</option>
        <option value="inactive">Inactive</option>
      </select>
    </div>

    <!-- Users Table -->
    <div class="table-container">
      <div class="table-header">
        <div class="header-cell">User</div>
        <div class="header-cell">Contact</div>
        <div class="header-cell">Status</div>
        <div class="header-cell">Verified</div>
        <div class="header-cell">Joined</div>
        <div class="header-cell">Actions</div>
      </div>
      <div class="table-row" *ngFor="let user of filteredUsers">
        <div class="cell user-cell">
          <div class="user-avatar">{{ (user.first_name ? user.first_name.charAt(0) : '') || (user.username ? user.username.charAt(0) : '') }}</div>
          <div class="user-info">
            <div class="user-name">{{user.first_name}} {{user.last_name}}</div>
            <div class="user-role">{{user.username}}</div>
          </div>
        </div>
        <div class="cell contact-cell">
          <div class="contact-info">
            <div class="email">{{user.email}}</div>
            <div class="phone">{{user.phone_number || 'N/A'}}</div>
          </div>
        </div>
        <div class="cell">
          <span class="status-badge" [class]="'status-' + (user.is_active ? 'active' : 'inactive')">
            {{user.is_active ? 'Active' : 'Inactive'}}
          </span>
        </div>
        <div class="cell">
          <span class="verification-badge" [class]="user.is_verified ? 'verified' : 'unverified'">
            <i class="fas" [class]="user.is_verified ? 'fa-check-circle' : 'fa-times-circle'"></i>
            {{user.is_verified ? 'Verified' : 'Unverified'}}
          </span>
        </div>
        <div class="cell">{{user.date_joined | date:'shortDate'}}</div>
        <div class="cell actions-cell">
          <button class="action-btn view" title="View"><i class="fas fa-eye"></i></button>
          <button class="action-btn edit" (click)="openModal('edit', user)" title="Edit"><i class="fas fa-edit"></i></button>
          <button class="action-btn delete" (click)="deleteUser(user.id)" title="Delete"><i class="fas fa-trash"></i></button>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <div class="pagination" *ngIf="totalPages > 1">
      <button class="page-btn" (click)="onPageChange(currentPage - 1)" [disabled]="currentPage === 1">
        <i class="fas fa-chevron-left"></i>
      </button>
      <span class="page-info">
        Page {{currentPage}} of {{totalPages}}
      </span>
      <button class="page-btn" (click)="onPageChange(currentPage + 1)" [disabled]="currentPage === totalPages">
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>{{modalMode === 'create' ? 'Add New User' : 'Edit User'}}</h3>
        <button class="close-btn" (click)="closeModal()"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <div class="form-grid">
          <div class="form-group">
            <label>First Name</label>
            <input type="text" [(ngModel)]="selectedUser.first_name" placeholder="Enter first name">
          </div>
          <div class="form-group">
            <label>Last Name</label>
            <input type="text" [(ngModel)]="selectedUser.last_name" placeholder="Enter last name">
          </div>
          <div class="form-group">
            <label>Email Address</label>
            <input type="email" [(ngModel)]="selectedUser.email" placeholder="Enter email">
          </div>
          <div class="form-group">
            <label>Phone Number</label>
            <input type="tel" [(ngModel)]="selectedUser.phone_number" placeholder="Enter phone">
          </div>
          <div class="form-group">
            <label>Status</label>
            <select [(ngModel)]="selectedUser.is_active">
              <option [value]="true">Active</option>
              <option [value]="false">Inactive</option>
            </select>
          </div>
          <div class="form-group">
            <label>Verified</label>
            <select [(ngModel)]="selectedUser.is_verified">
              <option [value]="true">Verified</option>
              <option [value]="false">Unverified</option>
            </select>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" (click)="closeModal()">Cancel</button>
        <button class="btn-primary" (click)="saveUser()">
          {{modalMode === 'create' ? 'Create User' : 'Update User'}}
        </button>
      </div>
    </div>
  </div>
</div>